<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AI Agents - Challenge Selection</title>

<!-- Fonts: Inter Variable (safe, web-hosted). No local install required. -->
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,300..800&display=swap" rel="stylesheet">

<style>
  :root{
    /* === Your timing choices === */
    --fade-duration: .6s;
    --icon-duration: .45s;
    --read-delay: 1.3s;      /* pause after each text line */
    --icons-after-text: .5s;  /* pause between text and icons */
    --icon-stagger: .1s;
    --phase-fade: .6s;        /* phase crossfade duration */

    /* Extra tuning */
    --intro-overlap: .15s;    /* start intro text slightly BEFORE intro fade-in fully ends */
    --btn-duration: 1.2s;     /* button reveal is 0.4s longer (used to be .8s) */

    /* Smooth easings (no sharp accelerations) */
    --ease-phase:     cubic-bezier(.42, 0, .58, 1); /* phase crossfade */
    --ease-text-out:  cubic-bezier(.42, 0, .58, 1); /* text fade/slide-in */
    --ease-overshoot: cubic-bezier(.42, 0, .58, 1); /* agent icons entrance */
    --ease-btn:       cubic-bezier(.42, 0, .58, 1); /* button entrance */
    --ease-hover:     cubic-bezier(.25, .1, .25, 1);/* subtle UI hover/press */

    /* Visual */
    --bg: linear-gradient(135deg,#faf9fc 0%,#f5f3f8 100%);
    --card: rgba(255,255,255,.95);
    --text:#2d2d3a; --text-secondary:#6b6b7d; --text-muted:#9393a4;
    --primary:#8b7df0; --primary-light:#a298f2; --primary-dark:#7165d8;
    --accent-mint:#b5e4d3; --accent-peach:#ffc6b0; --accent-lavender:#d8c9ff;
    --accent-rose:#ffb5cc; --accent-yellow:#ffe4a3; --accent-sky:#b3d9ff; --accent-coral:#ff9999;
    --shadow-sm:0 2px 8px rgba(0,0,0,.04);
    --shadow-md:0 8px 24px rgba(0,0,0,.06);
    --shadow-lg:0 16px 48px rgba(0,0,0,.08);
    --shadow-xl:0 24px 64px rgba(0,0,0,.1);
    --shadow-glow:0 0 80px rgba(139,125,240,.15);
    --radius-xl:24px;
    --transition: all .3s var(--ease-hover);

    /* Fonts: web-safe stack centered on Inter Variable (with Cyrillic) */
    --font-sans: "Inter", "Segoe UI Variable", "Segoe UI", ui-sans-serif, system-ui, -apple-system, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
  }

  *{box-sizing:border-box;margin:0;padding:0}

  /* Typography baseline — only font-related adjustments added */
  body{
    font-family: var(--font-sans);
    color:var(--text);
    background:var(--bg);
    min-height:100vh;
    overflow-x:hidden;
    position:relative;

    /* Enable variable font optical sizing and avoid faux bolding */
    font-optical-sizing: auto;
    font-synthesis-weight: none;

    /* Slightly improve legibility on Windows */
    text-rendering: optimizeLegibility;
  }

  /* Background orbs */
  .bg-orb{position:fixed;border-radius:50%;filter:blur(60px);opacity:.3;pointer-events:none;animation:float 20s ease-in-out infinite}
  .orb-1{width:400px;height:400px;background:var(--accent-lavender);top:-100px;right:-100px}
  .orb-2{width:300px;height:300px;background:var(--accent-sky);bottom:-150px;left:-150px;animation-delay:-5s}
  .orb-3{width:350px;height:350px;background:var(--accent-mint);top:50%;left:50%;transform:translate(-50%,-50%);animation-delay:-10s}
  @keyframes float{0%,100%{transform:translate(0,0) scale(1)}33%{transform:translate(30px,-30px) scale(1.05)}66%{transform:translate(-20px,20px) scale(.95)}}

  /* Phases crossfade with easing */
  .phase{
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
    opacity:0; pointer-events:none; transition:opacity var(--phase-fade) var(--ease-phase);
  }
  .phase.active{opacity:1; pointer-events:auto}

  /* Atomic revealers (non-linear) */
  .fade-up{opacity:0; transform:translateY(24px)}
  .fade-up.reveal{animation:fadeUp var(--fade-duration) var(--ease-text-out) both}
  @keyframes fadeUp{to{opacity:1; transform:translateY(0)}}

  .icon-bounce{opacity:0; transform:translateY(20px) scale(.9)}
  .icon-bounce.reveal{animation:iconBounce var(--icon-duration) var(--ease-overshoot) both}
  @keyframes iconBounce{
    60%{opacity:1; transform:translateY(-6px) scale(1.02)}
    100%{opacity:1; transform:translateY(0) scale(1)}
  }

  /* Button entrance (longer + eased) */
  .assemble-btn{opacity:0; transform:translateY(16px)}
  .assemble-btn.show{animation:btnUp var(--btn-duration) var(--ease-btn) both}
  @keyframes btnUp{to{opacity:1; transform:translateY(0)}}

  /* UI */
  .btn{
    padding:18px 48px; font-size:16px; font-weight:600; letter-spacing:.5px;
    border:none; border-radius:999px; color:#fff; background:linear-gradient(135deg,var(--primary),var(--primary-light));
    cursor:pointer; transition:var(--transition); box-shadow:var(--shadow-lg), var(--shadow-glow); position:relative; overflow:hidden;
  }
  .btn::before{content:""; position:absolute; inset:0; left:-100%; background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent); transition:left .8s var(--ease-hover)}
  .btn:hover{transform:translateY(-3px); box-shadow:var(--shadow-xl), 0 0 100px rgba(139,125,240,.3)}
  .btn:hover::before{left:100%}

  .gate-content{text-align:center}

  .intro-content{text-align:center; padding:0 24px; max-width:900px}
  .intro-title{
    font-size:clamp(28px,4.5vw,42px); font-weight:800; line-height:1.1;
    background:linear-gradient(135deg,var(--primary-dark),var(--primary-light));
    -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent; margin-bottom:20px;
  }
  .intro-subtitle{font-size:clamp(16px,2.5vw,20px); color:var(--text-muted)}

  #main{display:flex; align-items:center; justify-content:center; min-height:100vh; padding:20px}
  .main-wrapper{width:100%; max-width:1200px; display:flex; flex-direction:column; align-items:center; gap:28px}
  .main-container{
    width:100%; max-width:1320px; background:var(--card); backdrop-filter:blur(20px);
    border:1px solid rgba(255,255,255,.8); border-radius:32px; padding:48px 48px 16px; box-shadow:var(--shadow-xl), 0 0 120px rgba(139,125,240,.08);
  }
  .main-header{text-align:center; margin-bottom:40px}
  .main-title{
    font-size:clamp(32px,5vw,48px); font-weight:800; line-height:1.1;
    background:linear-gradient(135deg,var(--primary-dark),var(--primary-light));
    -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent; margin-bottom:12px;
  }
  .main-subtitle{font-size:16px; color:var(--text-muted); letter-spacing:.5px}
  .problems-grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(320px,1fr)); gap:32px; margin-bottom:28px}
  .problem-card{background:#fff; border:2px solid #f0f0f4; border-radius:var(--radius-xl); padding:32px; cursor:pointer; transition:all .6s var(--ease-hover); box-shadow:0 4px 16px rgba(0,0,0,.04)}
  .problem-card:hover{transform:translateY(-8px) scale(1.02); box-shadow:var(--shadow-xl), 0 20px 60px rgba(139,125,240,.15); border-color:var(--primary-light)}
  .problem-card.selected{transform:translateY(-10px) scale(1.03); box-shadow:var(--shadow-xl), 0 30px 80px rgba(139,125,240,.2); border-color:var(--primary)}
  .problem-icon{width:64px; height:64px; border-radius:50%; display:grid; place-items:center; margin-bottom:20px; box-shadow:var(--shadow-md)}
  .problem-icon svg{width:32px; height:32px}
  .problem-title{font-size:20px; font-weight:700; color:var(--text); margin-bottom:12px; letter-spacing:-.5px}
  .problem-desc{font-size:14px; color:var(--text-secondary); line-height:1.6}

  /* Insights Section */
  .insights-section{margin-top:16px}
  .section-header{text-align:center; margin-bottom:24px}
  .section-title{font-size:24px; font-weight:700; color:var(--text); margin-bottom:8px}
  .section-subtitle{font-size:14px; color:var(--text-muted)}
  .insights-grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:20px; margin-bottom:0}
  .insight-card{
    background:#fff; border:2px solid #f0f0f4; border-radius:20px; padding:24px; 
    cursor:pointer; transition:all .4s var(--ease-hover); box-shadow:0 2px 12px rgba(0,0,0,.03);
    display:flex; flex-direction:column; align-items:center; text-align:center;
  }
  .insight-card:hover{transform:translateY(-4px) scale(1.01); box-shadow:var(--shadow-lg); border-color:var(--primary-light)}
  .insight-card.selected{
    transform:translateY(-6px) scale(1.02); box-shadow:var(--shadow-lg), 0 16px 48px rgba(139,125,240,.15); 
    border-color:var(--primary); background:linear-gradient(135deg, rgba(139,125,240,.04), rgba(162,152,242,.06));
  }
  .insight-icon{
    width:48px; height:48px; border-radius:12px; display:grid; place-items:center; 
    margin-bottom:16px; box-shadow:0 2px 8px rgba(0,0,0,.06);
  }
  .insight-icon svg{width:24px; height:24px}
  .insight-title{font-size:16px; font-weight:600; color:var(--text); margin-bottom:8px}
  .insight-desc{font-size:13px; color:var(--text-secondary); line-height:1.5}

  /* Continue Button */
  .continue-section{text-align:center; min-height:60px; margin-top:0}
  .continue-btn{opacity:0; transform:translateY(16px)}
  .continue-btn.show{animation:btnUp var(--btn-duration) var(--ease-btn) both}

  #team-assembly{min-height:100vh; display:flex; align-items:center; justify-content:center; padding:40px 20px}
  .assembly-content{text-align:center; padding:0 24px; max-width:900px}
  .assembly-title{
    font-size:clamp(28px,4.5vw,42px); font-weight:800; line-height:1.1;
    background:linear-gradient(135deg,var(--primary-dark),var(--primary-light));
    -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent; margin-bottom:16px;
  }
  .assembly-subtitle{font-size:clamp(16px,2.5vw,20px); color:var(--text-muted)}

  .agent-icons{display:flex; justify-content:center; gap:24px; flex-wrap:wrap; margin:40px 0 56px}
  .agent-circle{width:64px; height:64px; border-radius:50%; display:grid; place-items:center; box-shadow:var(--shadow-sm); transition:all .3s var(--ease-hover); cursor:pointer}
  .agent-circle:hover{transform:translateY(-4px) scale(1.08); box-shadow:var(--shadow-md)}
  .agent-circle svg{width:32px; height:32px}

  @media (max-width:768px){
    .main-container{padding:32px 24px 12px}
    .main-wrapper{gap:24px}
    .problems-grid{grid-template-columns:1fr; gap:20px}
    .insights-grid{grid-template-columns:1fr}
    .agent-icons{gap:16px}
    .agent-circle{width:52px;height:52px}
    .agent-circle svg{width:26px;height:26px}
    .btn{padding:16px 36px;font-size:15px}
    .insights-section{margin-top:16px}
  }
</style>
</head>
<body>
  <!-- Background orbs -->
  <div class="bg-orb orb-1"></div>
  <div class="bg-orb orb-2"></div>
  <div class="bg-orb orb-3"></div>

  <!-- PHASE: Gate -->
  <div class="phase active" id="gate">
    <div class="gate-content">
      <button class="btn" id="startBtn">Start Presentation</button>
    </div>
  </div>

  <!-- PHASE: Intro -->
  <div class="phase" id="intro">
    <div class="intro-content">
      <h1 class="intro-title fade-up" id="introLine1">Collective intelligence, on your terms.</h1>
      <p class="intro-subtitle fade-up" id="introLine2">Different minds. One challenge.</p>
    </div>
  </div>

  <!-- PHASE: Main (no heading animations) -->
  <div class="phase" id="main">
    <div class="main-wrapper">
      <div class="main-container">
        <div class="main-header">
          <h2 class="main-title">Choose a challenge</h2>
          <p class="main-subtitle">Select the scenario you want to explore with AI specialists</p>
        </div>

        <div class="problems-grid">
          <div class="problem-card" data-problem="ER">
            <div class="problem-icon" style="background:linear-gradient(135deg,#d8c9ff,#e8deff)">
              <svg viewBox="0 0 24 24" fill="none">
                <rect x="3" y="7" width="18" height="12" rx="4" fill="#ffffff"/>
                <path d="M12 10v6M9 13h6" stroke="#7165d8" stroke-width="2.5" stroke-linecap="round"/>
              </svg>
            </div>
            <h3 class="problem-title">Emergency Room overload</h3>
            <p class="problem-desc">Urban hospital faces peak-time bottlenecks. Patients wait too long, staff rotate poorly, beds don't free fast enough. We want near-term changes we can pilot without new budget.</p>
          </div>

          <div class="problem-card" data-problem="Bus">
            <div class="problem-icon" style="background:linear-gradient(135deg,#b3d9ff,#c8e5ff)">
              <svg viewBox="0 0 24 24" fill="none">
                <rect x="3" y="6" width="18" height="10" rx="2" fill="#ffffff"/>
                <circle cx="8" cy="18" r="2" fill="#5a87c6"/>
                <circle cx="16" cy="18" r="2" fill="#5a87c6"/>
                <path d="M6 9h12" stroke="#5a87c6" stroke-width="2" stroke-linecap="round"/>
                <path d="M9 6v3M15 6v3" stroke="#5a87c6" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
            </div>
            <h3 class="problem-title">Winter bus delays</h3>
            <p class="problem-desc">Mid-size bus network struggles with cold starts, plowing and bunching. We need street-level fixes — depots, routing and rider comms — under existing constraints.</p>
          </div>
        </div>

        <!-- Insights Selection Section -->
        <div class="insights-section">
          <div class="section-header">
            <h3 class="section-title">What should the team focus on?</h3>
            <p class="section-subtitle">Select one or more areas to explore</p>
          </div>
          
          <div class="insights-grid">
            <div class="insight-card" data-insight="perspectives">
              <div class="insight-icon" style="background:linear-gradient(135deg,#ffe4a3,#ffecb8)">
                <svg viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="3" fill="#d4a853"/>
                  <path d="M12 5v2M12 17v2M5 12h2M17 12h2" stroke="#d4a853" stroke-width="2" stroke-linecap="round"/>
                  <path d="M7.05 7.05l1.41 1.41M15.54 15.54l1.41 1.41M7.05 16.95l1.41-1.41M15.54 8.46l1.41-1.41" stroke="#d4a853" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </div>
              <h4 class="insight-title">Perspectives</h4>
              <p class="insight-desc">Different lenses that reframe what to pay attention to</p>
            </div>

            <div class="insight-card" data-insight="tensions">
              <div class="insight-icon" style="background:linear-gradient(135deg,#ffb5cc,#ffc8db)">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M12 3v18" stroke="#d47a97" stroke-width="2" stroke-linecap="round"/>
                  <path d="M5 12h14" stroke="#d47a97" stroke-width="2" stroke-linecap="round"/>
                  <circle cx="8" cy="8" r="2" fill="#d47a97" opacity=".8"/>
                  <circle cx="16" cy="16" r="2" fill="#d47a97" opacity=".8"/>
                </svg>
              </div>
              <h4 class="insight-title">Tensions</h4>
              <p class="insight-desc">Productive trade-offs the team will explore together</p>
            </div>

            <div class="insight-card" data-insight="opportunities">
              <div class="insight-icon" style="background:linear-gradient(135deg,#b5e4d3,#c8f0e3)">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M12 2l3 7h7l-5.5 4 2 7-6.5-4.5L5.5 20l2-7L2 9h7z" fill="#6ab59d" opacity=".3"/>
                  <circle cx="12" cy="12" r="3" fill="#6ab59d"/>
                </svg>
              </div>
              <h4 class="insight-title">Opportunities</h4>
              <p class="insight-desc">Near-term ideas for low-cost pilots (no new budget)</p>
            </div>

            <div class="insight-card" data-insight="blindspots">
              <div class="insight-icon" style="background:linear-gradient(135deg,#d8c9ff,#e8deff)">
                <svg viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="9" stroke="#9d8ed4" stroke-width="2" fill="none"/>
                  <path d="M12 16v-4" stroke="#9d8ed4" stroke-width="2" stroke-linecap="round"/>
                  <circle cx="12" cy="8" r="1.5" fill="#9d8ed4"/>
                </svg>
              </div>
              <h4 class="insight-title">Blind Spots</h4>
              <p class="insight-desc">Key questions to guide your next conversation</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Continue Button (outside the white panel) -->
      <div class="continue-section">
        <button class="btn continue-btn" id="continueBtn">Continue</button>
      </div>
    </div>
  </div>

  <!-- PHASE: Team Assembly -->
  <div class="phase" id="team-assembly">
    <div class="assembly-content">
      <h2 class="assembly-title fade-up" id="finalLine1">Let's examine this from different angles.</h2>
      <p class="assembly-subtitle fade-up" id="finalLine2">We'll gather specialists with diverse perspectives.</p>

      <div class="agent-icons" id="iconsRow">
        <div class="icon-bounce"><div class="agent-circle" style="background:linear-gradient(135deg,#ffe4a3,#ffecb8)">
          <svg viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="10" r="3" fill="#d4a853"/>
            <path d="M6 20c0-4 2.5-6 6-6s6 2 6 6" fill="#d4a853" opacity=".6"/>
          </svg>
        </div></div>

        <div class="icon-bounce"><div class="agent-circle" style="background:linear-gradient(135deg,#ffb5cc,#ffc8db)">
          <svg viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="10" r="3" fill="#d47a97"/>
            <path d="M6 20c0-4 2.5-6 6-6s6 2 6 6" fill="#d47a97" opacity=".6"/>
          </svg>
        </div></div>

        <div class="icon-bounce"><div class="agent-circle" style="background:linear-gradient(135deg,#b5e4d3,#c8f0e3)">
          <svg viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="10" r="3" fill="#6ab59d"/>
            <path d="M6 20c0-4 2.5-6 6-6s6 2 6 6" fill="#6ab59d" opacity=".6"/>
          </svg>
        </div></div>

        <div class="icon-bounce"><div class="agent-circle" style="background:linear-gradient(135deg,#d8c9ff,#e8deff)">
          <svg viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="10" r="3" fill="#9d8ed4"/>
            <path d="M6 20c0-4 2.5-6 6-6s6 2 6 6" fill="#9d8ed4" opacity=".6"/>
          </svg>
        </div></div>

        <div class="icon-bounce"><div class="agent-circle" style="background:linear-gradient(135deg,#b3d9ff,#c8e5ff)">
          <svg viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="10" r="3" fill="#6a9dd4"/>
            <path d="M6 20c0-4 2.5-6 6-6s6 2 6 6" fill="#6a9dd4" opacity=".6"/>
          </svg>
        </div></div>
      </div>

      <button class="btn assemble-btn" id="finalAssembleBtn">Assemble the Team</button>
    </div>
  </div>

<script>
  // ------- Utilities -------
  const css = getComputedStyle(document.documentElement);
  const toMs = v => {
    const s = (v??'').toString().trim();
    if(s.endsWith('ms')) return parseFloat(s);
    if(s.endsWith('s')) return parseFloat(s)*1000;
    const n = parseFloat(s); return isNaN(n)?0:n;
  };
  const READ_DELAY = ()=> toMs(css.getPropertyValue('--read-delay'));
  const ICONS_AFTER_TEXT = ()=> toMs(css.getPropertyValue('--icons-after-text'));
  const ICON_STAGGER = ()=> toMs(css.getPropertyValue('--icon-stagger'));
  const INTRO_OVERLAP = ()=> toMs(css.getPropertyValue('--intro-overlap'));
  const PHASE_FADE = ()=> toMs(css.getPropertyValue('--phase-fade'));

  const wait = ms => new Promise(res=>setTimeout(res, ms));
  const onceAnimationEnd = el => new Promise(res=> el.addEventListener('animationend', res, { once:true }));
  const onceTransitionEnd = el => new Promise(res=>{
    const t = setTimeout(res, PHASE_FADE()+50);
    el.addEventListener('transitionend', (e)=>{
      if(e.propertyName==='opacity'){ clearTimeout(t); res(); }
    }, { once:true });
  });
  const reveal = el => el.classList.add('reveal');
  const hideReveal = el => el.classList.remove('reveal');

  // ------- Phases with controlled overlap option -------
  const phases = {
    gate: document.getElementById('gate'),
    intro: document.getElementById('intro'),
    main: document.getElementById('main'),
    team: document.getElementById('team-assembly')
  };
  let currentPhase = 'gate';

  /**
   * switchPhase(next, {overlapStartMs})
   * - Hides current, starts showing next.
   * - If overlapStartMs is set, we call onShown() after overlapStartMs (during fade-in).
   * - Otherwise, we wait until fade-in completes.
   */
  async function switchPhase(next, onShown, opts={}){
    const fromEl = phases[currentPhase];
    const toEl = phases[next];

    // hide current
    if(fromEl.classList.contains('active')){
      fromEl.classList.remove('active');
      await onceTransitionEnd(fromEl); // wait full fade-out
    }

    // show next
    toEl.classList.add('active');

    if(opts.overlapStartMs != null){
      // start callback slightly before fade-in fully ends
      await wait(Math.max(0, opts.overlapStartMs));
      if(typeof onShown==='function') onShown();
      // still finish the fade-in in the background
      await onceTransitionEnd(toEl);
    } else {
      // wait full fade-in, then callback
      await onceTransitionEnd(toEl);
      if(typeof onShown==='function') onShown();
    }
    currentPhase = next;
  }

  // ------- Intro sequence (uses overlap to reduce initial gap) -------
  const introLine1 = document.getElementById('introLine1');
  const introLine2 = document.getElementById('introLine2');

  async function startIntroSequence(){
    hideReveal(introLine1); hideReveal(introLine2);

    reveal(introLine1);
    await onceAnimationEnd(introLine1);
    await wait(READ_DELAY());

    reveal(introLine2);
    await onceAnimationEnd(introLine2);
    await wait(READ_DELAY());

    // Full phase switch to main (no overlap here for clarity)
    await switchPhase('main');
  }

  // ------- Team Assembly sequence -------
  const finalLine1 = document.getElementById('finalLine1');
  const finalLine2 = document.getElementById('finalLine2');
  const icons = Array.from(document.querySelectorAll('#iconsRow .icon-bounce'));
  const finalBtn = document.getElementById('finalAssembleBtn');

  async function startTeamAssemblySequence(){
    [finalLine1, finalLine2, ...icons].forEach(hideReveal);
    finalBtn.classList.remove('show');

    reveal(finalLine1);
    await onceAnimationEnd(finalLine1);
    await wait(READ_DELAY());

    reveal(finalLine2);
    await onceAnimationEnd(finalLine2);
    await wait(ICONS_AFTER_TEXT());

    // Icons stagger; after LAST icon appears, wait 0.5s then show button (with longer eased animation)
    const stagger = ICON_STAGGER();
    icons.forEach((icon, idx)=>{
      setTimeout(()=>{ reveal(icon); }, idx*stagger);
    });

    // Wait until the last icon has STARTED + its own animation duration, then extra 0.5s
    const lastStart = (icons.length-1)*stagger;
    const iconDuration = toMs(getComputedStyle(icons[0]).getPropertyValue('animation-duration') || getComputedStyle(document.documentElement).getPropertyValue('--icon-duration'));
    await wait(lastStart + iconDuration + 500); // 0.5s pause after last icon
    finalBtn.classList.add('show');
  }

  // ------- Selection tracking -------
  let selectedProblem = null;
  let selectedInsights = new Set();
  const continueBtn = document.getElementById('continueBtn');

  // ------- Problem cards selection -------
  document.querySelectorAll('.problem-card').forEach(card=>{
    card.addEventListener('click', async function(){
      document.querySelectorAll('.problem-card').forEach(c=>c.classList.remove('selected'));
      this.classList.add('selected');
      selectedProblem = this.dataset.problem;
      checkReadyToAssemble();
    });
  });

  // ------- Insight cards multi-selection -------
  document.querySelectorAll('.insight-card').forEach(card=>{
    card.addEventListener('click', function(){
      const insight = this.dataset.insight;
      if(selectedInsights.has(insight)){
        selectedInsights.delete(insight);
        this.classList.remove('selected');
      } else {
        selectedInsights.add(insight);
        this.classList.add('selected');
      }
      checkReadyToAssemble();
    });
  });

  // ------- Check if ready to show continue button -------
  function checkReadyToAssemble(){
    if(selectedProblem && selectedInsights.size > 0){
      // Show continue button with animation
      if(!continueBtn.classList.contains('show')){
        continueBtn.classList.add('show');
      }
    } else {
      // Hide button if conditions not met
      continueBtn.classList.remove('show');
    }
  }

  // ------- Continue button handler -------
  continueBtn.addEventListener('click', async ()=>{
    await switchPhase('team', startTeamAssemblySequence);
  });

  // ------- Wiring -------
  document.getElementById('startBtn').addEventListener('click', async ()=>{
    // Reduce the gap after Start: call intro sequence a bit BEFORE intro fade-in fully ends
    await switchPhase('intro', startIntroSequence, { overlapStartMs: INTRO_OVERLAP() });
  });

  finalBtn.addEventListener('click', ()=>{
    const insightsList = Array.from(selectedInsights).join(', ');
    alert(`Next screen: Team discussion for ${selectedProblem === 'ER' ? 'Emergency Room' : 'Bus Network'} challenge...\nFocus areas: ${insightsList}`);
  });
</script>
</body>
</html>